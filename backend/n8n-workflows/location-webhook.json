[{"updatedAt":"2026-02-10T17:22:31.000Z","createdAt":"2026-02-09T18:54:42.476Z","id":"bqnjDFzYlhFRj9F4","name":"Nexus Location Webhook","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"nexus-location","authentication":"headerAuth","responseMode":"responseNode","options":{}},"id":"1","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[250,300],"webhookId":"nexus-location","credentials":{"httpHeaderAuth":{"id":"SZxrJ8QXk6ZennvF","name":"Nexus API Key"}}},{"parameters":{"operation":"executeQuery","query":"SELECT life.ingest_location(\n {{ $json.body.latitude }}::numeric,\n {{ $json.body.longitude }}::numeric,\n {{ $json.body.location_name ? \"'\" + $json.body.location_name.replace(/'/g, \"''\") + \"'\" : 'NULL' }},\n '{{ $json.body.event_type || \"poll\" }}',\n {{ $json.body.activity ? \"'\" + $json.body.activity.replace(/'/g, \"''\") + \"'\" : 'NULL' }},\n '{{ $json.body.source || \"home_assistant\" }}'\n) AS location_id;","options":{}},"id":"2","name":"Ingest Location","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[450,300],"credentials":{"postgres":{"id":"p5cyLWCZ9Db6GiiQ","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT core.process_location_update(\n {{ $('Webhook').item.json.body.latitude }}::double precision,\n {{ $('Webhook').item.json.body.longitude }}::double precision,\n '{{ $('Webhook').item.json.body.event_type || \"poll\" }}',\n {{ $('Webhook').item.json.body.location_name ? \"'\" + $('Webhook').item.json.body.location_name.replace(/'/g, \"''\") + \"'\" : 'NULL' }}\n) AS result;","options":{}},"id":"5","name":"Match & Track","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[650,300],"credentials":{"postgres":{"id":"p5cyLWCZ9Db6GiiQ","name":"Postgres account"}}},{"parameters":{"jsCode":"const ingest = $('Ingest Location').first().json;\nconst geo = $('Match & Track').first().json;\nconst result = typeof geo.result === 'string' ? JSON.parse(geo.result) : geo.result;\nreturn [{\n json: {\n success: true,\n location_id: ingest.location_id,\n matched_zones: result.matched_zones || [],\n enter_events: result.enter_events || [],\n exit_events: result.exit_events || []\n }\n}];"},"id":"6","name":"Build Response","type":"n8n-nodes-base.code","typeVersion":2,"position":[850,300]},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}"},"id":"3","name":"Success Response","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1050,300]},{"parameters":{"respondWith":"json","responseBody":"={{ { success: false, error: $json.message || 'Unknown error' } }}","options":{"responseCode":500}},"id":"4","name":"Error Response","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[650,500]}],"connections":{"Webhook":{"main":[[{"node":"Ingest Location","type":"main","index":0}]]},"Ingest Location":{"main":[[{"node":"Match & Track","type":"main","index":0}]]},"Match & Track":{"main":[[{"node":"Build Response","type":"main","index":0}]]},"Build Response":{"main":[[{"node":"Success Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"2c2257e4-376b-46f4-8daf-472db39abf5f","activeVersionId":"2c2257e4-376b-46f4-8daf-472db39abf5f","versionCounter":29,"triggerCount":1,"tags":[{"updatedAt":"2026-01-23T10:40:45.845Z","createdAt":"2026-01-23T10:40:45.845Z","id":"lDthDin72aX56mEW","name":"location"},{"updatedAt":"2026-01-23T10:40:45.834Z","createdAt":"2026-01-23T10:40:45.834Z","id":"sExNsob7BRbG6MPX","name":"lifeos"}],"shared":[{"updatedAt":"2026-02-09T18:54:42.481Z","createdAt":"2026-02-09T18:54:42.481Z","role":"workflow:owner","workflowId":"bqnjDFzYlhFRj9F4","projectId":"22AdcA5nOuNzxaWv","project":{"updatedAt":"2026-01-16T12:45:07.892Z","createdAt":"2026-01-16T12:19:29.617Z","id":"22AdcA5nOuNzxaWv","name":"Ahmed Arafa <arafa.uwl19@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"6e352323-f0d8-4767-9f6d-163557aaa469"}}]}]
