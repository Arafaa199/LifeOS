# SMS Financial Message Regex Patterns
# Generated from analysis of ~/tmp/lifeos_sms/chat.db
# Last updated: 2026-01-23
# Test file: test_sms_patterns.py (validates against real data)
# Coverage: 1558 matched, 0 unmatched from tracked senders

# =============================================================================
# PATTERN PRIORITY ORDER (higher = process first)
# =============================================================================
# 1. EXCLUDE patterns (OTP, security, promo)
# 2. DECLINED patterns (never create transactions)
# 3. SALARY/INCOME patterns
# 4. REFUND patterns
# 5. TRANSFER patterns
# 6. PURCHASE patterns (most common)
# 7. ATM/WITHDRAWAL patterns
# 8. CREDIT CARD STATEMENT/PAYMENT patterns

# =============================================================================
# EXCLUDE PATTERNS (never process as financial)
# =============================================================================
exclude_patterns:
  - name: otp_verification
    regex: '(OTP|verification code|رمز التحقق|رمز التوثيق|code is|One-Time Password)'
    reason: "Authentication codes"

  - name: apple_pay_setup
    regex: '(add.*to.*wallet|Apple Pay.*(setup|activated|ready|added|enabled)|card.*ready for contactless|successfully added.*Apple Pay)'
    reason: "Card setup/activation notifications (not POS payments via Apple Pay)"

  - name: card_authorization_request
    regex: '(يوجد لديك دفعة.*تتطلب موافقتك)'
    reason: "Pre-authorization requests (not actual transactions)"

  - name: credit_card_statement
    regex: '(كشف حساب مصغّر|statement.*due)'
    reason: "Credit card statements (informational)"

  - name: promo_marketing
    regex: '(offer|discount|عرض.*خصم|خصم\s*\d+|extr\.ly)'
    reason: "Marketing messages (note: exclude خصم+number, not بطاقة خصم)"

  - name: card_settings_change
    regex: '(تم.*تحديث إعدادات الحماية)'
    reason: "Security settings notifications"

  - name: credit_card_approval
    regex: '(has been approved with a credit limit)'
    reason: "Credit card approval notifications"

  - name: amazon_order_placed
    regex: '(Order for .+ is (successfully placed|shipped))'
    reason: "Order confirmations, not financial transactions"

  - name: account_login_notification
    regex: '(تم توثيق عملية تسجيل دخول|new login|logged in from)'
    reason: "Login notifications (informational)"

  - name: language_preference_update
    regex: '(تم تحديث.*تفضيلات اللغة|language preference.*updated)'
    reason: "Language preference changes (informational)"

  - name: address_update_notification
    regex: '(تم تحديث عنوانك|address.*updated successfully)'
    reason: "Address update notifications (informational)"

  - name: payment_failed_notification
    regex: '(payment.*didn.*go through|Your payment.*didn)'
    reason: "Failed payment notifications (no transaction created)"

  - name: alrajhi_otp
    regex: '(One Time Password\nCode:)'
    reason: "AlRajhi OTP verification codes"

  - name: merchant_category_blocked
    regex: '(merchant category is blocked|category.*is blocked)'
    reason: "Merchant category blocked notifications (no transaction)"

  - name: card_issue_notification
    regex: '(encountered a problem adding your card|card.*was successfully removed|We encountered a problem)'
    reason: "Card setup/removal notifications (informational)"

  - name: beneficiary_notification
    regex: '(المستفيد المضاف حديثًا|تمت إضافة المستفيد|Beneficiary (activated|added))'
    reason: "Beneficiary management notifications (informational)"

  - name: apple_pay_added_ar
    regex: '(لقد تم إضافة خدمة Apple Pay)'
    reason: "Apple Pay setup notification (Arabic)"

  - name: banking_tariff_fees
    regex: '(banking tariff fees|رسوم.*التعريفة)'
    reason: "Banking tariff fee notifications (informational)"

  - name: terms_conditions
    regex: '(terms and conditions related|الشروط والأحكام)'
    reason: "Terms and conditions notifications (informational)"

  - name: login_attempt_ar
    regex: '(لفت انتباهنا محاولتك تسجيل الدخول|suspicious login)'
    reason: "Suspicious login alerts (informational)"

  - name: insufficient_funding
    regex: '(Due to insufficient fund|insufficient fundin)'
    reason: "Insufficient funding notifications (informational)"

  - name: transaction_could_not_complete_ar
    regex: '(لقد تعذر إكمال معاملة)'
    reason: "Transaction could not be completed (declined, Arabic)"

  - name: password_changed
    regex: '(Password has been changed|تم تغيير.*كلمة المرور)'
    reason: "Password change notifications (informational)"

  - name: device_registration
    regex: '(New device registered|new device.*detected|device.*Face ID|Login using Touch/Face ID)'
    reason: "Device/biometric registration notifications (informational)"

  - name: payment_declined_update
    regex: '(Payment declined:.*Payment update required|payment update required)'
    reason: "Payment update required notifications (informational)"

# =============================================================================
# EMIRATESNBD PATTERNS (Arabic - Primary UAE Bank)
# =============================================================================
emiratesnbd:
  sender: "EmiratesNBD"

  patterns:
    # ----- SALARY -----
    - name: salary_deposit
      intent: income
      confidence: 0.99
      regex: 'تم ايداع الراتب\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+في\s+حسابك'
      entities: [currency, amount]
      sample: "تم ايداع الراتب AED 23,500.00 في  حسابك .101XXX79XXX04 الرصيد المتوفر هو AED 23,514.47"

    # ----- DEBIT CARD PURCHASE -----
    - name: debit_purchase
      intent: expense
      confidence: 0.95
      regex: 'تمت عملية شراء بقيمة\s+(?P<currency>AED|SAR|JOD|USD|EUR|GBP)\s+(?P<amount>[\d,]+\.?\d*)\s+لدى\s+(?P<merchant>[^,]+)\s*,\s*(?P<city>.+?)\s+باستخدام بطاقة خصم'
      entities: [currency, amount, merchant, city]
      sample: "تمت عملية شراء بقيمة AED 165.00 لدى B 27 BARBERSHOP LLC ,Dubai باستخدام بطاقة خصم"

    # ----- CREDIT CARD PURCHASE -----
    - name: credit_purchase
      intent: expense
      confidence: 0.95
      regex: 'تمت عملية شراء في\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+(?P<merchant>[^,]+),\s*(?P<city>.+?)\s+على البطاقة'
      entities: [currency, amount, merchant, city]
      sample: "تمت عملية شراء في AED 1,326.28 LOGIC UTILITIES DIST C,DUBAI على البطاقة 4695"

    # ----- ATM WITHDRAWAL -----
    - name: atm_withdrawal
      intent: expense
      confidence: 0.95
      regex: 'لقد قمت بسحب مبلغ\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+مستخدما بطاقة الصراف الآلي'
      entities: [currency, amount]
      category: "ATM"
      sample: "لقد قمت بسحب مبلغ AED 100.00 مستخدما بطاقة الصراف الآلي من DUBAI"

    # ----- BANK TRANSFER (OUTGOING) -----
    - name: transfer_outgoing
      intent: transfer
      confidence: 0.95
      regex: 'تم خصم\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+من حسابك.*لتحويل الأموال'
      entities: [currency, amount]
      category: "Transfer"
      sample: "تم خصم AED 15,000.00 من حسابك 3304 لتحويل الأموال"

    # ----- CREDIT CARD PAYMENT (from account) -----
    - name: credit_card_payment
      intent: expense
      confidence: 0.95
      regex: 'تم خصم مبلغ\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+من حسابك.*لتسديد مستحقات بطاقتك'
      entities: [currency, amount]
      category: "Credit Card Payment"
      sample: "تم خصم مبلغ AED 4,800.99 من حسابك 101XXX79XXX04 لتسديد مستحقات بطاقتك الائتمانية"

    # ----- REFUND -----
    - name: refund
      intent: refund
      confidence: 0.95
      regex: 'لقد تم إعادة مبلغ عملية شراء بقيمة\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)'
      entities: [currency, amount]
      sample: "لقد تم إعادة مبلغ عملية شراء بقيمة AED 1.00"

    # ----- DECLINED -----
    - name: declined
      intent: declined
      confidence: 0.99
      regex: 'تم رفض معاملة بقيمة\s+(?P<amount>[\d,]+\.?\d*)(?P<currency>AED|SAR|JOD|USD)'
      entities: [amount, currency]
      never_create_transaction: true
      sample: "تم رفض معاملة بقيمة 250.00AED على بطاقتك"

    # ----- DECLINED - INSUFFICIENT LIMIT (ARABIC) -----
    - name: declined_insufficient
      intent: declined
      confidence: 0.99
      regex: 'تم رفض عملية بقيمة\s+(?P<currency>AED|SAR|JOD|USD|EUR|GBP)\s+(?P<amount>[\d,]+\.?\d*)\s+على بطاقتك\s+(?P<card>\d+)\s+لدى\s+(?P<merchant>[^\s].+?)\s+بسبب'
      entities: [currency, amount, card, merchant]
      never_create_transaction: true
      sample: "تم رفض عملية بقيمة AED 99.00 على بطاقتك 8236 لدى CAREEM BIKE بسبب عدم كفاية الحد"

    # ----- COULD NOT BE COMPLETED (ARABIC) -----
    - name: declined_incomplete
      intent: declined
      confidence: 0.99
      regex: 'لقد تعذر إكمال معاملة بقيمة\s+(?P<amount>[\d,]+\.?\d*)\s+(?P<currency>AED|SAR|JOD|USD|EUR|GBP).*?بطاقتك.*?(?:بـ\s*)?(?P<card>\d+)'
      entities: [amount, currency, card]
      never_create_transaction: true
      sample: "لقد تعذر إكمال معاملة بقيمة 99.45 USD منفذة ببطاقتك التي تنتهي أرقامها بـ 9865"

    # ----- FUND HOLD (for instant transfer) -----
    - name: fund_hold
      intent: transfer
      confidence: 0.90
      regex: 'تمّ تقييد مبلغ\s+(?P<currency>AED|SAR|JOD|USD)\s+(?P<amount>[\d,]+\.?\d*)\s+في حسابك'
      entities: [currency, amount]
      category: "Transfer"
      sample: "تمّ تقييد مبلغ AED 30,000.00 في حسابك مقابل عملية تحويل فورية"

    # ===== ENGLISH PATTERNS =====

    # ----- DEBIT CARD PURCHASE (ENGLISH) -----
    - name: debit_purchase_en
      intent: expense
      confidence: 0.95
      regex: 'Purchase of (?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s+(?P<amount>[\d,]+\.?\d*)\s+with Debit Card ending (?P<card>\d+)\s+at\s+(?P<merchant>[^,.]+)'
      entities: [currency, amount, card, merchant]
      sample: "Purchase of AED 4.99 with Debit Card ending 8236 at noon one, 80038888. Avl Balance is AED 7.17."

    # ----- DECLINED - INSUFFICIENT LIMIT (ENGLISH) -----
    - name: declined_insufficient_en
      intent: declined
      confidence: 0.99
      regex: 'Transaction of (?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s+(?P<amount>[\d,]+\.?\d*)\s+on your Card (?:\d+|ending \d+)\s+at\s+(?P<merchant>[^\s].+?)\s+was declined'
      entities: [currency, amount, merchant]
      never_create_transaction: true
      sample: "Transaction of AED 568.02 on your Card 8236 at DUBAI ELECTRICITY AND was declined due to insufficient limit."

    # ----- DECLINED - COULD NOT BE COMPLETED (ENGLISH) -----
    - name: declined_incomplete_en
      intent: declined
      confidence: 0.99
      regex: 'Transaction of (?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s+(?P<amount>[\d,]+\.?\d*)\s+on your Card ending (?P<card>\d+)\s+could not be completed'
      entities: [currency, amount, card]
      never_create_transaction: true
      sample: "Transaction of USD 1.00 on your Card ending 9865 could not be completed. For Details, Please call 600540000"

    # ----- FUNDS TRANSFER TO CARD (ENGLISH) -----
    - name: funds_transfer_in_en
      intent: income
      confidence: 0.90
      regex: 'Funds Transfer of (?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s+(?P<amount>[\d,]+\.?\d*)\s+has been initiated towards your Debit Card ending (?P<card>\d+)'
      entities: [currency, amount, card]
      category: "Transfer"
      sample: "Funds Transfer of AED 871.94 has been initiated towards your Debit Card ending 8236. The amount will be credited to your account."

    # ----- AUTH CODE / OTP (ENGLISH) -----
    - name: auth_code_en
      intent: ignore
      confidence: 0.99
      regex: '(?:DO NOT SHARE!?\s*)?(?:The )?Auth code is (?P<code>\d+)\s+for (?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s+(?P<amount>[\d,]+\.?\d*)\s+at\s+(?P<merchant>[^\s].+?)\s+for card ending (?P<card>\d+)'
      entities: [code, currency, amount, merchant, card]
      never_create_transaction: true
      sample: "DO NOT SHARE! The Auth code is 806012 for USD 0.00 at ANTHROPIC for card ending 9865. Use in 5 mins."

    # ----- LOGIN NOTIFICATION (ENGLISH) -----
    - name: login_notification_en
      intent: ignore
      confidence: 0.99
      regex: 'Dear Customer,?\s+a new login to (?:Mobile|Online)(?:/(?:Mobile|Online))?\s+Banking has been authorised'
      entities: []
      never_create_transaction: true
      sample: "Dear Customer, a new login to Mobile/Online Banking has been authorised for device Chrome-127.0.0.0."

# =============================================================================
# ALRAJHIBANK PATTERNS (English - Saudi Bank)
# =============================================================================
alrajhibank:
  sender: "AlRajhiBank"

  patterns:
    # ----- REFUND POS (MUST BE BEFORE pos_purchase) -----
    - name: refund_pos
      intent: refund
      confidence: 0.95
      regex: 'Refund\s+PoS\nBy:(?P<card>\d+);(?P<method>[^\n]+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [card, method, currency, amount]
      sample: |
        Refund PoS
        By:8308;mada
        Amount:SAR 38.94
        At:Amazon SA

    # ----- POS PURCHASE (LOCAL) -----
    - name: pos_purchase
      intent: expense
      confidence: 0.95
      regex: 'PoS\nBy:(?P<card>\d+);(?P<method>[^\n]+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\n(?:At:(?P<merchant>[^\n]+))?'
      entities: [card, method, currency, amount, merchant]
      sample: |
        PoS
        By:8308;mada-Apple Pay
        Amount:SAR 48
        At:KAKAT CO

    # ----- POS PURCHASE (INTERNATIONAL) -----
    - name: pos_international
      intent: expense
      confidence: 0.95
      regex: 'PoS International\nBy:(?P<card>\d+);(?P<method>[^\n]+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\n(?:Country:(?P<country>[^\n]+)\n)?(?:At:(?P<merchant>[^\n]+)\n)?'
      entities: [card, method, currency, amount, country, merchant]
      sample: |
        PoS International
        By:8308;mada
        Amount:SAR 30.91
        Country:Netherlands
        At:UBR* PENDING.UBER.COM

    # ----- ONLINE PURCHASE -----
    - name: online_purchase
      intent: expense
      confidence: 0.95
      regex: 'Online Purchase\nBy:(?P<card>\d+);(?P<method>[^\n]+)\n(?:From:(?P<from>\d+)\n)?Amount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [card, method, from, currency, amount]
      sample: |
        Online Purchase
        By:8308;mada
        From:4281
        Amount:SAR 988.60
        At:Amazon SA

    # ----- ATM WITHDRAWAL -----
    - name: atm_withdrawal
      intent: expense
      confidence: 0.95
      regex: 'Withdrawal:ATM\nBy:(?P<card>\d+);(?P<method>[^\n]+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [card, method, currency, amount]
      category: "ATM"
      sample: |
        Withdrawal:ATM
        By:8308;mada
        Amount:SAR 50
        Place:MARAHEL ROOM

    # ----- INTERNAL TRANSFER (OUTGOING) -----
    - name: internal_transfer_out
      intent: transfer
      confidence: 0.95
      regex: 'Internal Transfer\nFrom:(?P<from>\d+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>[^\n]+)'
      entities: [from, currency, amount, to]
      category: "Transfer"
      sample: |
        Internal Transfer
        From:4281
        Amount:SAR 4000
        To:MOSTAFA AHMED

    # ----- INTERNAL TRANSFER (INCOMING) -----
    - name: internal_transfer_in
      intent: income
      confidence: 0.95
      regex: 'Internal Transfer\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>\d+)\nFrom:(?P<from>[^\n]+)'
      entities: [currency, amount, to, from]
      category: "Income"
      sample: |
        Internal Transfer
        Amount:SAR 3000
        To:4281
        From:MOSTAFA AHMED

    # ----- LOCAL TRANSFER (INCOMING) -----
    - name: local_transfer_in
      intent: income
      confidence: 0.95
      regex: 'Local Transfer\nVia:(?P<via>\w+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>\d+)\nFrom:(?P<from>[^\n]+)'
      entities: [via, currency, amount, to, from]
      category: "Income"
      sample: |
        Local Transfer
        Via:BSFR
        Amount:SAR 21100
        To:4281
        From:FADI WALID M ASSAF

    # ----- BILL PAYMENT -----
    - name: bill_payment
      intent: expense
      confidence: 0.95
      regex: 'Bill Payment\nFrom:(?P<from>\d+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nBiller:(?P<biller>[^\n]+)\n(?:Service:(?P<service>[^\n]+)\n)?'
      entities: [from, currency, amount, biller, service]
      category: "Bills"
      sample: |
        Bill Payment
        From:4281
        Amount:SAR 124.70
        Biller:044
        Service:ZAIN
        Bill:592256616

    # ----- CREDIT TRANSFER INTERNAL (OUTGOING) -----
    - name: credit_transfer_internal_out
      intent: transfer
      confidence: 0.95
      regex: 'Credit Transfer Internal\nFrom:(?P<from>\d+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>[^\n]+)'
      entities: [from, currency, amount, to]
      category: "Transfer"
      sample: |
        Credit Transfer Internal
        From:4281
        Amount:SAR 1000
        To:AHMED

    # ----- CREDIT TRANSFER INTERNAL (INCOMING) -----
    - name: credit_transfer_internal_in
      intent: income
      confidence: 0.95
      regex: 'Credit Transfer Internal\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>\d+)\nFrom:(?P<from>[^\n]+)'
      entities: [currency, amount, to, from]
      category: "Income"
      sample: |
        Credit Transfer Internal
        Amount:SAR 3000
        To:4281
        From:MOSTAFA AHMED

    # ----- CREDIT TRANSFER LOCAL (OUTGOING) -----
    - name: credit_transfer_local_out
      intent: transfer
      confidence: 0.95
      regex: 'Credit Transfer Local\nFrom:(?P<from>\d+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>[^\n]+)'
      entities: [from, currency, amount, to]
      category: "Transfer"
      sample: |
        Credit Transfer Local
        From:4281
        Amount:SAR 500
        To:BANK ACCOUNT

    # ----- DEBIT TRANSFER INTERNATIONAL -----
    - name: debit_transfer_international
      intent: expense
      confidence: 0.95
      regex: 'Debit [Tt]ransfer[:\s]*International\nCountry:(?P<country>[^\n]+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [country, currency, amount]
      category: "Transfer"
      sample: |
        Debit transfer:International
        Country:United Arab Emirates
        Amount:AED 871.94

    # ----- DEBIT TRANSFER LOCAL -----
    - name: debit_transfer_local
      intent: expense
      confidence: 0.95
      regex: 'Debit Transfer Local\n(?:Bank:(?P<bank>\w+)\n)?(?:From:(?P<from>\d+)\n)?Amount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [bank, from, currency, amount]
      category: "Transfer"
      sample: |
        Debit Transfer Local
        Bank:BSFR
        From:4281
        Amount:SAR 500

    # ----- CREDIT TRANSFER LOCAL (INCOMING VIA) -----
    - name: credit_transfer_local_in_via
      intent: income
      confidence: 0.95
      regex: 'Credit Transfer Local\nVia:(?P<via>\w+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>\d+)\nFrom:(?P<from>[^\n]+)'
      entities: [via, currency, amount, to, from]
      category: "Income"
      sample: |
        Credit Transfer Local
        Via:INMA
        Amount:SAR 350
        To:4281
        From:TARIQ HAITHAM

    # ----- CREDIT TRANSFER LOCAL (OUTGOING VIA) -----
    - name: credit_transfer_local_out_via
      intent: transfer
      confidence: 0.95
      regex: 'Credit Transfer Local\nVia:(?P<via>\w+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nTo:(?P<to>[^\n]+)'
      entities: [via, currency, amount, to]
      category: "Transfer"
      sample: |
        Credit Transfer Local
        Via:SAB
        Amount:SAR 2000
        To:4281

    # ----- MOI PAYMENTS (Government) -----
    - name: moi_payment
      intent: expense
      confidence: 0.95
      regex: 'MOI Payments\nFrom:(?P<from>\d+)\nAmount:(?P<currency>SAR|AED|USD|EUR|GBP|JOD)\s*(?P<amount>[\d,]+\.?\d*)\nProvider:(?P<provider>[^\n]+)'
      entities: [from, currency, amount, provider]
      category: "Government"
      sample: |
        MOI Payments
        From:4281
        Amount:SAR 700
        Provider:Residence permit

# =============================================================================
# JKB PATTERNS (English/Arabic - Jordan Kuwait Bank)
# =============================================================================
jkb:
  senders: ["JKB", "jkb"]

  patterns:
    # ----- POS PURCHASE -----
    - name: pos_purchase
      intent: expense
      confidence: 0.95
      regex: 'You have an approved purchase trx on POS for (?P<currency>SAR|JOD|AED|BHD|EGP|USD|EUR|GBP)\s*(?P<amount>[\d,]+\.?\d*)\s+on your card'
      entities: [currency, amount]
      sample: "You have an approved purchase trx on POS for SAR 20.00 on your card #5513***3612, at Boufia Majid Ahmed Ibr, JEDDAH"

    # ----- E-COMMERCE PURCHASE -----
    - name: ecommerce_purchase
      intent: expense
      confidence: 0.95
      regex: 'You have an approved Ecommerce trx\s+for\s+(?P<currency>SAR|JOD|AED|BHD|EGP|USD|EUR|GBP)\s*(?P<amount>[\d,]+\.?\d*)\s+on your card'
      entities: [currency, amount]
      sample: "You have an approved Ecommerce trx  for SAR 33.84 on your card #5361***9793, at UBER * PENDING, Vorden"

    # ----- ATM WITHDRAWAL -----
    - name: atm_withdrawal
      intent: expense
      confidence: 0.95
      regex: 'You have an approved withdrawal trx for (?P<currency>SAR|JOD|AED|BHD|EGP|USD)\s*(?P<amount>[\d,]+\.?\d*)\s+on your card'
      entities: [currency, amount]
      category: "ATM"
      sample: "You have an approved withdrawal trx for SAR 1100.00 on your card#5513***3612, at INMA BANK, RIYADH"

    # ----- REVERSAL (REFUND) -----
    - name: reversal
      intent: refund
      confidence: 0.95
      regex: 'You have an approved reversal trx for (?P<currency>SAR|JOD|AED|BHD|EGP|USD|EUR|GBP)\s*(?P<amount>[\d,]+\.?\d*)\s+on your card'
      entities: [currency, amount]
      sample: "You have an approved reversal trx for SAR 500.00 on your card # 5513***3612"

    # ----- DECLINED -----
    - name: declined
      intent: declined
      confidence: 0.99
      regex: 'You have a declined trx on your card.*for\s+(?P<currency>SAR|JOD|AED|BHD|EGP|USD|EUR|GBP)\s*(?P<amount>[\d,]+\.?\d*)\s+due to insufficient'
      entities: [currency, amount]
      never_create_transaction: true
      sample: "You have a declined trx on your card # 5361***9793 from Hungerstation, Riyadh,  for SAR 136.00 due to insufficient funds"

    # ----- ACCOUNT FEE (Arabic - code currency) -----
    - name: account_fee
      intent: expense
      confidence: 0.90
      regex: 'تم قيد مبلغ\s+(?P<amount>[\d,]+\.?\d*)\s+(?P<currency>JOD|SAR|AED|USD|EUR|GBP|JOD)\s+على حسابكم.*عمولة تدني'
      entities: [amount, currency]
      category: "Bank Fees"
      sample: "تم قيد مبلغ 1  JOD  على حسابكم  التوفير  0266XXXXXXX0013020000  عمولة تدني رصيد الحساب"

    # ----- ACCOUNT FEE (Arabic - spelled currency) -----
    - name: account_fee_arabic
      intent: expense
      confidence: 0.90
      regex: 'تم قيد مبلغ\s+(?P<amount>[\d,]+\.?\d*)\s+(?P<currency>دينار أردني|ريال سعودي|درهم إماراتي)\s+على حسابكم.*عمولة تدني'
      entities: [amount, currency]
      category: "Bank Fees"
      sample: "تم قيد مبلغ 1  دينار أردني على حسابكم التوفير  026607308360013020000  عمولة تدني رصيد الحساب"

    # ----- DEPOSIT (Arabic) -----
    - name: deposit
      intent: income
      confidence: 0.90
      regex: 'تم ايداع\s+مبلغ\s+(?P<amount>[\d,]+\.?\d*)\s+في\s+حسابك'
      entities: [amount]
      sample: "تم ايداع  مبلغ 4 في   حسابك التوفير رقم 0266XXXXXXX0013020000"

    # ----- CREDIT (Arabic) -----
    - name: credit
      intent: income
      confidence: 0.90
      regex: 'تم قيد\s+مبلغ\s+(?P<amount>[\d,]+\.?\d*)\s+على\s+حسابك'
      entities: [amount]
      sample: "تم قيد  مبلغ 237.869 على   حسابك التوفير رقم 0266XXXXXXX0013020000"

# =============================================================================
# CAREEM PATTERNS (English - Ride/Food Delivery)
# =============================================================================
careem:
  sender: "CAREEM"

  patterns:
    # ----- ORDER REFUND TO WALLET -----
    - name: order_refund
      intent: refund
      confidence: 0.95
      regex: 'your order (?P<order>\d+) has been cancelled and (?P<currency>AED|SAR|JOD|USD)\s*(?P<amount>[\d,]+\.?\d*)\s+has been refunded'
      entities: [order, currency, amount]
      note: "Refund to Careem Wallet, not bank account"
      sample: "Hi Arafa, your order 145001255 has been cancelled and AED 255.95 has been refunded to your Wallet."

# =============================================================================
# AMAZON PATTERNS (English - E-commerce)
# =============================================================================
amazon:
  senders: ["Amazon", "amazon"]

  patterns:
    # ----- REFUND NOTIFICATION -----
    - name: refund_notification
      intent: refund
      confidence: 0.90
      regex: 'Refund Issued: Amount (?P<currency>SAR|AED|USD|EUR)\s*(?P<amount>[\d,]+\.?\d*)'
      entities: [currency, amount]
      note: "Amazon refund - may take 5-7 business days"
      sample: "Refund Issued: Amount SAR 195.05 (EYSOO Protein Shaker Bottle 20...)."

# =============================================================================
# TABBY PATTERNS (Tabby Card spending & refunds)
# =============================================================================
tabby:
  senders: ["Tabby", "tabby", "Tabby-AD", "AD-Tabby"]

  patterns:
    # ----- CARD SPENDING -----
    - name: tabby_card_spend
      intent: expense
      confidence: 0.95
      regex: 'You spent (?P<amount>[\d,]+\.?\d*)\s*(?P<currency>AED|SAR|USD|EUR|GBP)\s*at\s*(?P<merchant>.+?)\.\s*Your available'
      entities: [amount, currency, merchant]
      category: null
      sample: "You spent 248.83 AED at CAREEM QUIK. Your available Tabby Card limit is now 313.08 AED."

    # ----- REFUND -----
    - name: tabby_refund
      intent: refund
      confidence: 0.95
      regex: "(?:partially )?refunded your (?P<merchant>.+?) order for (?P<currency>AED|SAR|USD|EUR|GBP)\\s*(?P<amount>[\\d,]+\\.?\\d*)"
      entities: [merchant, currency, amount]
      sample: "We've partially refunded your carrefouruae.com order for AED 4.99. To view details, go to https://tabby.ai/sd/Qo9MTc"

    # ----- BNPL PURCHASE CONFIRMED -----
    - name: tabby_bnpl_purchase
      intent: expense
      confidence: 0.95
      regex: 'Your (?P<currency>AED|SAR|USD|EUR|GBP)\s*(?P<amount>[\d,]+\.?\d*)\s*purchase at (?P<merchant>.+?) is confirmed'
      entities: [currency, amount, merchant]
      category: null
      never_create_transaction: true
      note: "BNPL purchase - handled separately by importBNPLPurchases"
      sample: "Your AED 4976.57 purchase at Amazon.ae is confirmed. Track your upcoming payments with the Tabby app"

    # ----- OTP CODE (Do not tell anyone) -----
    - name: tabby_otp_code
      intent: ignore
      confidence: 1.0
      regex: 'Do not tell anyone this code'
      entities: []
      never_create_transaction: true

# =============================================================================
# TASHEEL FIN PATTERNS (Arabic - BNPL Card Purchases)
# =============================================================================
tasheel:
  senders: ["TASHEEL FIN", "tasheel fin"]

  patterns:
    # ----- PURCHASE CONFIRMATION (Western digits + ريال) -----
    - name: tasheel_purchase_confirmed
      intent: expense
      confidence: 0.95
      subtype: purchase_confirmed
      regex: 'تمت العملية بنجاح بمبلغ\s*(?P<amount>[\d,]+\.?\d*)\s*(?P<currency>ريال|ر\.س|AED|SAR|USD|EUR|GBP|JOD)\s+من\s+(?P<merchant>[^\s].+?)\s+بتاريخ'
      entities: [amount, currency, merchant]
      sample: "عزيزي العميل، تمت العملية بنجاح بمبلغ189.52 ريال من carrefouruae.com بتاريخ 22-01-"

    # ----- PURCHASE NOTIFICATION (Arabic numerals + currency code) -----
    - name: tasheel_purchase_notification
      intent: expense
      confidence: 0.95
      subtype: purchase_notification
      regex: 'عملية شراء بمبلغ\s*(?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s*(?P<amount>[\d٠-٩،,]+[\.٫][\d٠-٩]+)\s+في\s+(?P<merchant>[^\s].+?)\s+بدولة\s+(?P<country>\w+)'
      entities: [currency, amount, merchant, country]
      sample: "عملية شراء بمبلغ AED ١٨٥٫٥٤  في carrefouruae.com بدولة ARE بتاريخ 2026-01-22 20:34:36"

    # ----- REFUND -----
    - name: tasheel_refund
      intent: refund
      confidence: 0.95
      regex: 'تم إرجاع مبلغ بقيمة\s*(?P<amount>[\d٠-٩،,]+[\.٫]?[\d٠-٩]*)\s*(?P<currency>ريال سعودي|ريال|ر\.س|AED|SAR|USD|EUR|GBP|JOD)'
      entities: [amount, currency]
      sample: "عزيزي العميل، تم إرجاع مبلغ بقيمة ٣٩٢٫٤٦ ريال سعودي من بطاقتك الائتما"

    # ----- BNPL PAYMENT (installment paid to بسيطة) -----
    - name: tasheel_bnpl_payment
      intent: ignore
      confidence: 0.95
      regex: 'تم دفع مبلغ\s+(?P<amount>[\d٠-٩،,]+[\.٫]?[\d٠-٩]*)(?P<currency>ريال سعودي|ريال|ر\.س)\s+لحساب بسيطة'
      entities: [amount, currency]
      never_create_transaction: true
      note: "BNPL installment payment — the bank debit is captured via AlRajhi SMS"
      sample: "عزيزي العميل، لقد تم دفع مبلغ   ٣٧٢٫٩٤ريال سعودي لحساب بسيطة الخاصة بك"

    # ----- DECLINED ATTEMPT -----
    - name: tasheel_declined
      intent: declined
      confidence: 0.99
      regex: 'محاولة إتمام العملية بمبلغ\s*\n?\s*(?P<currency>AED|SAR|USD|EUR|GBP|JOD)\s*(?P<amount>[\d٠-٩،,]+[\.٫][\d٠-٩]+)\s+برقم البطاقة'
      entities: [currency, amount]
      never_create_transaction: true
      sample: "عزيزي العميل، محاولة إتمام العملية بمبلغ\nJOD ٥٫٠٠ برقم البطاقة المنته"

    # ----- AUTO-PAYMENT DECLINED (English) -----
    - name: tasheel_autopay_declined_en
      intent: declined
      confidence: 0.99
      regex: 'Your card ending with (?P<card>\d+) has been declined for auto-payment'
      entities: [card]
      never_create_transaction: true
      sample: "Your card ending with 2273 has been declined for auto-payment and will be tried again tomorrow."

    # ----- STATEMENT ISSUED (informational) -----
    - name: tasheel_statement
      intent: ignore
      confidence: 0.99
      regex: 'تم إصدار كشف الحساب لبسيطة'
      entities: []
      never_create_transaction: true
      sample: "تم إصدار كشف الحساب لبسيطة. قم بدفع المبلغ المستحق 376  ر.س"

    # ----- EARLY SETTLEMENT (informational) -----
    - name: tasheel_early_settlement
      intent: ignore
      confidence: 0.99
      regex: 'تم استلام مبلغ السداد المبكر'
      entities: []
      never_create_transaction: true
      sample: "تم استلام مبلغ السداد المبكر لجميع العمليات."

    # ----- PROMO/MARKETING -----
    - name: tasheel_promo
      intent: ignore
      confidence: 0.99
      regex: 'سدد ورصيدك يرجع لك'
      entities: []
      never_create_transaction: true
      sample: "سدد ورصيدك يرجع لك وتقدر تشتري فيه بأي مكان"

# =============================================================================
# SUPPORTED CURRENCIES
# =============================================================================
currencies:
  codes: [AED, SAR, JOD, BHD, EGP, USD, EUR, GBP]
  arabic_names:
    "دينار أردني": JOD
    "ريال سعودي": SAR
    "درهم إماراتي": AED
    "درهم": AED
    "ريال": SAR
    "ر.س": SAR

# =============================================================================
# INTENT CATEGORIES
# =============================================================================
intent_categories:
  income:
    - salary_deposit
    - local_transfer_in
    - internal_transfer_in
    - deposit
    - credit

  expense:
    - debit_purchase
    - credit_purchase
    - pos_purchase
    - pos_international
    - ecommerce_purchase
    - online_purchase
    - atm_withdrawal
    - credit_card_payment
    - account_fee
    - account_fee_arabic

  transfer:
    - transfer_outgoing
    - internal_transfer_out
    - fund_hold

  refund:
    - refund
    - refund_pos
    - reversal
    - order_refund
    - refund_notification

  declined:
    - declined

# =============================================================================
# CATEGORY MAPPING (merchant -> category)
# =============================================================================
merchant_category_hints:
  # Groceries
  - pattern: '(CAREEM QUIK|CAREEM FOOD|Tamimi|LULU|grocery|supermarket|سوبرماركت)'
    category: Grocery

  # Restaurants
  - pattern: '(restaurant|SUSHI|PAK DARBAR|Hungerstation|food|delivery|طعام)'
    category: Restaurant

  # Transport
  - pattern: '(ENOC|ADNOC|petrol|fuel|بنزين|UBER|Careem|TAXI)'
    category: Transport

  # Utilities
  - pattern: '(DEWA|ELECTRICITY|e&|Du|etisalat|utilities|كهرباء)'
    category: Utilities

  # Health
  - pattern: '(PHARMACY|LIFE PHARMACY|medical|health|صيدلية|مستشفى)'
    category: Health

  # Shopping
  - pattern: '(Amazon|IKEA|noon|Tabby|online|متجر|DUTY FREE)'
    category: Shopping

  # Subscriptions
  - pattern: '(Claude|HACKTHEBOX|HTB|subscription|اشتراك)'
    category: Subscription

  # Personal Care
  - pattern: '(BARBERSHOP|HAIR|barber|salon|حلاق)'
    category: Personal Care
